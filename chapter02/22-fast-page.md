## 2.2 页面快速响应

页面快速响应主要集中解决两方面的问题，一个是减少正常访问的白屏等待时间，二是在断网和弱网情况下能够浏览已缓存的页面，避免白屏。

主要通过提供页面架构和离线缓存来支持的。
 
### 2.2.1 页面架构

首先来看一下图 2-1 所示，在访问站点时能快速呈现页面的基本布局，减少用户的白屏等待时间，其实这就是前面所说的页面架构。它能够让用户首先对页面布局有个提前认知，等待具体的内容数据返回后再呈现具体的内容，提升用户的浏览体验，示例中页面布局包含头部导航、侧边导航、内容区等。

![](https://gss0.bdstatic.com/9rkZbzqaKgQUohGko9WTAnF6hhy/assets/pwa/projects/1515680651561/appshell.png)
图2-1 页面架构 示意图

这个页面架构，通俗理解就是对于一个应用来说相对不变或较稳定的结构，在第三章节[设计与体验]()会有更加详细的讲解。

### 2.2.1 离线缓存

但是，单有一个 App Shell 骨架并不能保证在断网和弱网的情况下，快速响应页面呢？不难理解，我们可以通过把 App Shell 缓存在本地来支持这一需求。原本 HTML5 为 Web 应用专门提供了一个应用程序缓存机制方法 —— AppCache，但是由于该接口设计上存在一定的缺陷，未能普及开来，现在随时可能被停用删除，那取而代之的就是今天要隆重介绍的 Service Workers。它的出现让 Web 应用离线访问成为可能，让 Web 开发者们如获至宝，我们的示例中也是利用它来让站点实现离线缓存的。

- 首先，Service Worker 可以支持预缓存和动态缓存两种，项目中一些静态资源及 App Shell 均可以通过预缓存在用户首次访问站点时就缓存在本地 Cache 中，挡在次访问站点时直接读取缓存，运行所给示例，打开调试窗口的 `Application` 下的 `Caches` ，右键`refresh cache` 即可查看示例中已预缓存的内容。除此之外，还可以看到动态缓存的一些请求数据，如下图所示。

- 在调试窗口的 `NetWork`勾选`offline`选项，再次刷新页面，页面能够快速呈现，查看`NetWork`页面查看请求返回是`From Service Worker`，如下图所示。


Service worker是一个注册在指定源和路径下的事件驱动 worker。它可以关联页面或者网站，拦截并修改访问和资源请求，细粒度地缓存资源，你可以根据不同的情形采用指定的缓存策略，让网站交互更友好。具体的开发细节、现有开发工具及使用等将在第四章节[离线与缓存]()做重点介绍。同时，出于网络安全的考虑，页面及网站请求都要求是 HTTPS 承载，第五章节[安全]()。




